<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="google-site-verification" content="aG_tXROG9wF9yK4g29KmnltUUXyLK5SBAWKIXDkz6vU"><title>Babel polyfill - Fedeoo&#039;s Blog</title><link rel="manifest" href="/en/manifest.json"><meta name="application-name" content="Fedeoo&#039;s Blog"><meta name="msapplication-TileImage" content="/gallery/site/shark.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Fedeoo&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="As a front developer, we should keep in mind what browsers are used by our customers.  We say only modern browsers and IE 11 are supported, at least users won’t get an error on IE 11.  Our config is :"><meta property="og:type" content="blog"><meta property="og:title" content="Babel polyfill"><meta property="og:url" content="http://blog.feibyte.com/en/2019/08/25/journeyman/babel-polyfill-enigma/"><meta property="og:site_name" content="Fedeoo&#039;s Blog"><meta property="og:description" content="As a front developer, we should keep in mind what browsers are used by our customers.  We say only modern browsers and IE 11 are supported, at least users won’t get an error on IE 11.  Our config is :"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://blog.feibyte.com/en/gallery/thumbnails/babel.png"><meta property="article:published_time" content="2019-08-25T05:09:56.000Z"><meta property="article:modified_time" content="2024-05-16T12:28:19.728Z"><meta property="article:author" content="Fedeoo"><meta property="article:tag" content="FE"><meta property="article:tag" content="babel"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://blog.feibyte.com/en/gallery/thumbnails/babel.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.feibyte.com/en/2019/08/25/journeyman/babel-polyfill-enigma/"},"headline":"Babel polyfill","image":["http://blog.feibyte.com/en/gallery/thumbnails/babel.png"],"datePublished":"2019-08-25T05:09:56.000Z","dateModified":"2024-05-16T12:28:19.728Z","author":{"@type":"Person","name":"Fedeoo"},"publisher":{"@type":"Organization","name":"Fedeoo's Blog","logo":{"@type":"ImageObject","url":"http://blog.feibyte.com/gallery/site/logo.png"}},"description":"As a front developer, we should keep in mind what browsers are used by our customers.  We say only modern browsers and IE 11 are supported, at least users won’t get an error on IE 11.  Our config is :"}</script><link rel="canonical" href="http://blog.feibyte.com/en/2019/08/25/journeyman/babel-polyfill-enigma/"><link rel="icon" href="/en/gallery/site/shark.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/en/css/default.css"><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-773NDPTQE0" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-773NDPTQE0');</script><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.2.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/en/"><img src="/en/gallery/site/logo.png" alt="Fedeoo&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/en/">Home</a><a class="navbar-item" href="/en/archives">Archives</a><a class="navbar-item" href="/en/categories">Categories</a><a class="navbar-item" href="/en/tags">Tags</a><a class="navbar-item" href="/en/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="简体中文" href="https://blog.feibyte.com/">简体中文</a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/feibyte/feibyte.github.io"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-08-25T05:09:56.000Z" title="8/25/2019, 3:09:56 PM">2019-08-25</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-05-16T12:28:19.728Z" title="5/16/2024, 10:28:19 PM">2024-05-16</time></span><span class="level-item"><a class="link-muted" href="/en/categories/Explorations/">Explorations</a></span><span class="level-item">8 minutes read (About 1231 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">Babel polyfill</h1><div class="content"><p>As a front developer, we should keep in mind what browsers are used by our customers.  We say only modern browsers and IE 11 are supported, at least users won’t get an error on IE 11.  Our config is : <code>[&#39;last 2 versions&#39;, &#39;ie &gt;= 11&#39;]</code> and here’s detailed browsers: <a target="_blank" rel="noopener" href="https://browserl.ist/?q=last+2+versions">last 2 versions</a>.  If you find your config is different from this one, please ensure your config is a superset of the above list.</p>
<span id="more"></span>
<h2 id="Mystery-of-Babel"><a href="#Mystery-of-Babel" class="headerlink" title="Mystery of  Babel"></a>Mystery of  Babel</h2><p>With <code>Babel</code>, we could use new features of ES without worrying about compatibility.  You must have got some error saying browser doesn’t support it even you’re using babel. Yeah, you might know we still have to take care of polyfill.  Have you ever been confused about various babel packages? </p>
<p><code>@babel/preset-env</code> <code>@babel/transform-runtime</code> <code>@babel/runtime</code>  <code>@babel/polyfill</code></p>
<p>To help you better understand those, Let’s do some experiment.<br>Let’s say the source code looks like this:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="title function_">method</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> arr = <span class="title class_">Array</span>.<span class="title function_">from</span>([<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> s = <span class="keyword">new</span> <span class="title class_">Symbol</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line">array.<span class="title function_">includes</span>(<span class="function"><span class="params">item</span> =&gt;</span> item &gt; <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>();</span><br></pre></td></tr></table></figure>
<p>Please note: <code>class</code> <code>arrow function</code> <code>let</code> <code>const</code> are part of the syntax. </p>
<p><code>Promise</code> and <code>Symbol</code> and <code>Array.from</code>  belong to global properties and static properties.</p>
<p><code>[].includes</code> is instance property.</p>
<h3 id="Preset-env"><a href="#Preset-env" class="headerlink" title="Preset-env"></a>Preset-env</h3><p>Firstly, we just add <code>preset-env</code> and see what’s the outcode looks like</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  <span class="string">&quot;@babel/env&quot;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>Outcode(output 1) ⬇️⬇️⬇️⬇️⬇️ </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _marked =</span><br><span class="line"><span class="comment">/*#__PURE__*/</span></span><br><span class="line">regeneratorRuntime.<span class="title function_">mark</span>(gen);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_classCallCheck</span>(<span class="params">instance, Constructor</span>) &#123; <span class="keyword">if</span> (!(instance <span class="keyword">instanceof</span> <span class="title class_">Constructor</span>)) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Cannot call a class as a function&quot;</span>); &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_defineProperties</span>(<span class="params">target, props</span>) &#123; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; props.<span class="property">length</span>; i++) &#123; <span class="keyword">var</span> descriptor = props[i]; descriptor.<span class="property">enumerable</span> = descriptor.<span class="property">enumerable</span> || <span class="literal">false</span>; descriptor.<span class="property">configurable</span> = <span class="literal">true</span>; <span class="keyword">if</span> (<span class="string">&quot;value&quot;</span> <span class="keyword">in</span> descriptor) descriptor.<span class="property">writable</span> = <span class="literal">true</span>; <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, descriptor.<span class="property">key</span>, descriptor); &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_createClass</span>(<span class="params">Constructor, protoProps, staticProps</span>) &#123; <span class="keyword">if</span> (protoProps) <span class="title function_">_defineProperties</span>(<span class="title class_">Constructor</span>.<span class="property"><span class="keyword">prototype</span></span>, protoProps); <span class="keyword">if</span> (staticProps) <span class="title function_">_defineProperties</span>(<span class="title class_">Constructor</span>, staticProps); <span class="keyword">return</span> <span class="title class_">Constructor</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> A =</span><br><span class="line"><span class="comment">/*#__PURE__*/</span></span><br><span class="line"><span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">A</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">_classCallCheck</span>(<span class="variable language_">this</span>, A);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">_createClass</span>(A, [&#123;</span><br><span class="line">    <span class="attr">key</span>: <span class="string">&quot;method&quot;</span>,</span><br><span class="line">    <span class="attr">value</span>: <span class="keyword">function</span> <span class="title function_">method</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  &#125;]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> A;</span><br><span class="line">&#125;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = <span class="title class_">Array</span>.<span class="title function_">from</span>([<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> <span class="title class_">Symbol</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">gen</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> regeneratorRuntime.<span class="title function_">wrap</span>(<span class="keyword">function</span> <span class="title function_">gen$</span>(<span class="params">_context</span>) &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">switch</span> (_context.<span class="property">prev</span> = _context.<span class="property">next</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">          _context.<span class="property">next</span> = <span class="number">2</span>;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;end&quot;</span>:</span><br><span class="line">          <span class="keyword">return</span> _context.<span class="title function_">stop</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, _marked);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line">array.<span class="title function_">includes</span>(<span class="keyword">function</span> (<span class="params">item</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> item &gt; <span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> set = <span class="keyword">new</span> <span class="title class_">Promise</span>();</span><br></pre></td></tr></table></figure>
<p>As we can see, babel transforms new syntax to the old one for us. But didn’t change the static methods in the new feature. (Notice it’s using global <code>regeneratorRuntime</code> )</p>
<p>If we specify targets only for modern browsers like below: </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  <span class="string">&quot;@babel/env&quot;</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">targets</span>: &#123;</span><br><span class="line">        <span class="attr">browsers</span>: [<span class="string">&#x27;Chrome 70&#x27;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>The outcode is almost same with source code. It’s not surprising.</p>
<p>Let’s move on. Now we set <code>useBuiltIns</code> as ‘usage’</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  <span class="string">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">targets</span>: &#123;</span><br><span class="line">      <span class="attr">browsers</span>: [<span class="string">&#x27;defaults&#x27;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">useBuiltIns</span>: <span class="string">&#x27;usage&#x27;</span>,</span><br><span class="line">    <span class="attr">corejs</span>: <span class="number">3</span>, <span class="comment">// using useBuiltIns without declare corejs version will get warning.</span></span><br><span class="line">    <span class="attr">modules</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<p>We found babel imported a few files for us.  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/es.symbol&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/es.symbol.description&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/es.array.from&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/es.array.includes&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/es.object.to-string&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/es.promise&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/es.string.iterator&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;regenerator-runtime/runtime&quot;</span>;</span><br><span class="line"><span class="comment">// Below is same with output1</span></span><br></pre></td></tr></table></figure>
<p>From now I set modules as false, so the outcode is using import rather than require.</p>
<p><code>useBuiltIns</code> has another option: ‘entry’.  </p>
<p>It won’t import polyfill for us. We still have to import polyfill by yourself but it will import specific files in terms of your target setting. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;core-js/stable&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;regenerator-runtime/runtime&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>If in your entry files, you have the above code, it will transform to the below one. (It depends on your target browsers. Even you never use it in your code.)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/es.symbol.description&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/es.symbol.async-iterator&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/es.array.flat&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/es.array.flat-map&quot;</span>;</span><br><span class="line">....</span><br><span class="line"><span class="comment">// very long  </span></span><br></pre></td></tr></table></figure>
<h3 id="Transform-runtime"><a href="#Transform-runtime" class="headerlink" title="Transform-runtime"></a>Transform-runtime</h3><p>Let’s disable <code>useBuiltIns</code> and move on. Add plugins to babel config file: <code>&quot;plugins&quot;: [&quot;@babel/plugin-transform-runtime&quot;]</code></p>
<p>The outcode:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _regeneratorRuntime <span class="keyword">from</span> <span class="string">&quot;@babel/runtime/regenerator&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> _classCallCheck <span class="keyword">from</span> <span class="string">&quot;@babel/runtime/helpers/classCallCheck&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> _createClass <span class="keyword">from</span> <span class="string">&quot;@babel/runtime/helpers/createClass&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _marked =</span><br><span class="line"><span class="comment">/*#__PURE__*/</span></span><br><span class="line">_regeneratorRuntime.<span class="title function_">mark</span>(gen);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> A =</span><br><span class="line"><span class="comment">/*#__PURE__*/</span></span><br><span class="line"><span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">A</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">_classCallCheck</span>(<span class="variable language_">this</span>, A);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">_createClass</span>(A, [&#123;</span><br><span class="line">    <span class="attr">key</span>: <span class="string">&quot;method&quot;</span>,</span><br><span class="line">    <span class="attr">value</span>: <span class="keyword">function</span> <span class="title function_">method</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  &#125;]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> A;</span><br><span class="line">&#125;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = <span class="title class_">Array</span>.<span class="title function_">from</span>([<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> <span class="title class_">Symbol</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">gen</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> _regeneratorRuntime.<span class="title function_">wrap</span>(<span class="keyword">function</span> <span class="title function_">gen$</span>(<span class="params">_context</span>) &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">switch</span> (_context.<span class="property">prev</span> = _context.<span class="property">next</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">          _context.<span class="property">next</span> = <span class="number">2</span>;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;end&quot;</span>:</span><br><span class="line">          <span class="keyword">return</span> _context.<span class="title function_">stop</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, _marked);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line">array.<span class="title function_">includes</span>(<span class="keyword">function</span> (<span class="params">item</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> item &gt; <span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>();</span><br></pre></td></tr></table></figure>
<p>This outcode is a bit different from the previous. As the <a target="_blank" rel="noopener" href="https://babeljs.io/docs/en/babel-plugin-transform-runtime#technical-details">documentation</a>, by default, it set regenerator as true. Besides, it replaced inline helper with the module. But it didn’t import any polyfill files.</p>
<p>Let’s try other params:  <code>[&quot;@babel/plugin-transform-runtime&quot;, &#123;&quot;corejs&quot;: 3 &#125;]</code></p>
<p>The out code</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _Promise <span class="keyword">from</span> <span class="string">&quot;@babel/runtime-corejs3/core-js-stable/promise&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> _includesInstanceProperty <span class="keyword">from</span> <span class="string">&quot;@babel/runtime-corejs3/core-js-stable/instance/includes&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> _regeneratorRuntime <span class="keyword">from</span> <span class="string">&quot;@babel/runtime-corejs3/regenerator&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> _Symbol <span class="keyword">from</span> <span class="string">&quot;@babel/runtime-corejs3/core-js-stable/symbol&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> _Array$from <span class="keyword">from</span> <span class="string">&quot;@babel/runtime-corejs3/core-js-stable/array/from&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> _classCallCheck <span class="keyword">from</span> <span class="string">&quot;@babel/runtime-corejs3/helpers/classCallCheck&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> _createClass <span class="keyword">from</span> <span class="string">&quot;@babel/runtime-corejs3/helpers/createClass&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _marked =</span><br><span class="line"><span class="comment">/*#__PURE__*/</span></span><br><span class="line">_regeneratorRuntime.<span class="title function_">mark</span>(gen);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> A =</span><br><span class="line"><span class="comment">/*#__PURE__*/</span></span><br><span class="line"><span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">A</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">_classCallCheck</span>(<span class="variable language_">this</span>, A);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">_createClass</span>(A, [&#123;</span><br><span class="line">    <span class="attr">key</span>: <span class="string">&quot;method&quot;</span>,</span><br><span class="line">    <span class="attr">value</span>: <span class="keyword">function</span> <span class="title function_">method</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  &#125;]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> A;</span><br><span class="line">&#125;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = <span class="title function_">_Array$from</span>([<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> <span class="title function_">_Symbol</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">gen</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> _regeneratorRuntime.<span class="title function_">wrap</span>(<span class="keyword">function</span> <span class="title function_">gen$</span>(<span class="params">_context</span>) &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">switch</span> (_context.<span class="property">prev</span> = _context.<span class="property">next</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">          _context.<span class="property">next</span> = <span class="number">2</span>;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;end&quot;</span>:</span><br><span class="line">          <span class="keyword">return</span> _context.<span class="title function_">stop</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, _marked);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"></span><br><span class="line"><span class="title function_">_includesInstanceProperty</span>(array).<span class="title function_">call</span>(array, <span class="keyword">function</span> (<span class="params">item</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> item &gt; <span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="title function_">_Promise</span>();</span><br></pre></td></tr></table></figure>
<p>Here you see: it helped us handle new global properties even instance properties in a different way. It was using internal methods, which means it won’t pollute prototype or global namespace.</p>
<p>It’s commonly used in the development of the third library. </p>
<p>Also, you might have already noticed, we should ensure the packages used in outcode is accessible. <code>@babel/runtime</code> or <code>core-js</code> or <code>regenerator-runtime/runtime</code>  (<code>@babel/polyfill</code> has been deprecated.  use <code>core-js/stable</code> and <code>regenerator-runtime/runtime</code> directly. )</p>
<h3 id="Which-one-we-should-choose"><a href="#Which-one-we-should-choose" class="headerlink" title="Which one we should choose"></a>Which one we should choose</h3><p>Here’s <a target="_blank" rel="noopener" href="https://babeljs.io/docs/en/babel-polyfill#usage-in-node-browserify-webpack">guide</a></p>
<p>If we take a look at CRA  <a target="_blank" rel="noopener" href="https://github.com/facebook/create-react-app/blob/master/packages/babel-preset-react-app/create.js">create.js</a>  it’s using <code>@babel/plugin-transform-runtime</code> to save on codesize and regenerator polyfill.  In <code>@babel/preset-env</code> set <code>useBuiltIns: &#39;entry&#39;</code>, it means we should import polyfill by ourselves.  Here’s detailed documentation: <a target="_blank" rel="noopener" href="https://create-react-app.dev/docs/supported-browsers-features#supported-browsers">https://create-react-app.dev/docs/supported-browsers-features#supported-browsers</a>  </p>
<p>For us, maybe the best way is aligning our solution to CRA. For the micro front end,  the best way is to import polyfill in the shell entry, others don’t need import twice.</p>
<p>I know, even we import all polyfill files, it doesn’t make much difference. Anyway, we’re stepping into the right direction.</p>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/en/tags/FE/">FE</a><a class="link-muted mr-2" rel="tag" href="/en/tags/babel/">babel</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/en/2020/01/17/journeyman/Auth0-lock-issue/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Auth0 lock issue</span></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'http://blog.feibyte.com/en/2019/08/25/journeyman/babel-polyfill-enigma/';
            this.page.identifier = '2019/08/25/journeyman/babel-polyfill-enigma/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'blog-feibyte-com' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/en/gallery/site/shark.png" alt="Fedeoo"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Fedeoo</p><p class="is-size-6 is-block">Engineer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Sydney</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/en/archives"><p class="title">7</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Category</p><a href="/en/categories"><p class="title">1</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/en/tags"><p class="title">12</p></a></div></div></nav></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/en/categories/Explorations/"><span class="level-start"><span class="level-item">Explorations</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><figure class="media-left"><a class="image" href="/en/2024/06/02/DynamoDB%20single%20table%20design/"><img src="/en/gallery/thumbnails/2024/dynamodb.png" alt="DynamoDB the Advantages and Considerations of Single Table Design"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-06-02T11:22:56.000Z">2024-06-02</time></p><p class="title"><a href="/en/2024/06/02/DynamoDB%20single%20table%20design/">DynamoDB the Advantages and Considerations of Single Table Design</a></p><p class="categories"><a href="/en/categories/Explorations/">Explorations</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/en/2024/05/21/AWS-connect-last-agent-call-routing/"><img src="/en/gallery/thumbnails/2024/call-center.png" alt="AWS connect last agent call routing"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-05-21T11:22:56.000Z">2024-05-21</time></p><p class="title"><a href="/en/2024/05/21/AWS-connect-last-agent-call-routing/">AWS connect last agent call routing</a></p><p class="categories"><a href="/en/categories/Explorations/">Explorations</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/en/2024/05/16/AWS-client-getaddrinfo-EMFILE-issue/"><img src="/en/gallery/thumbnails/aws/lambda.png" alt="AWS client getaddrinfo EMFILE issue"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-05-16T13:17:22.000Z">2024-05-16</time></p><p class="title"><a href="/en/2024/05/16/AWS-client-getaddrinfo-EMFILE-issue/">AWS client getaddrinfo EMFILE issue</a></p><p class="categories"><a href="/en/categories/Explorations/">Explorations</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/en/2024/05/11/How-to-prevent-duplicate-SQS-messages/"><img src="/en/gallery/thumbnails/2024/sqs.png" alt="How to prevent duplicate SQS messages"></a></figure><div class="media-content"><p class="date"><time dateTime="2024-05-10T21:52:05.000Z">2024-05-11</time></p><p class="title"><a href="/en/2024/05/11/How-to-prevent-duplicate-SQS-messages/">How to prevent duplicate SQS messages</a></p><p class="categories"><a href="/en/categories/Explorations/">Explorations</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/en/2020/02/14/novice/cache-memory-issue/"><img src="/en/gallery/thumbnails/troubleshooting.jpg" alt="A bug which should have been solved a week ago"></a></figure><div class="media-content"><p class="date"><time dateTime="2020-02-14T11:05:00.000Z">2020-02-14</time></p><p class="title"><a href="/en/2020/02/14/novice/cache-memory-issue/">A bug which should have been solved a week ago</a></p><p class="categories"><a href="/en/categories/Explorations/">Explorations</a></p></div></article></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/en/tags/Serviceless/"><span class="tag">Serviceless</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/en/tags/AWS/"><span class="tag">AWS</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/en/tags/FE/"><span class="tag">FE</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/en/tags/Client/"><span class="tag">Client</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/en/tags/Amazon-connect/"><span class="tag">Amazon connect</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/en/tags/DynamoDB/"><span class="tag">DynamoDB</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/en/tags/SQS-Processor/"><span class="tag">SQS Processor</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/en/tags/Auth0/"><span class="tag">Auth0</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/en/"><img src="/en/gallery/site/logo.png" alt="Fedeoo&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2024 Fedeoo</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/en/js/column.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/en/js/back_to_top.js" defer></script><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script><!--!--><!--!--><!--!--><script src="/en/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/en/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/en/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>